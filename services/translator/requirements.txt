# Configuration d'environnement
python-dotenv==1.2.1

# Framework web
fastapi==0.115.6
uvicorn[standard]==0.34.0
pydantic-settings==2.7.1
pydantic==2.10.5

# Communication gRPC et ZeroMQ
grpcio==1.69.0
grpcio-tools==1.69.0
grpcio-reflection==1.69.0
protobuf==5.29.3
pyzmq==26.2.0

# Machine Learning et NLP
# Versions gérées par chatterbox-tts pour compatibilité
# torch, torchaudio, transformers, librosa installés via chatterbox-tts
# CRITICAL: numpy<1.24 pour compatibilité ESPnet 202412
# ESPnet 202412 nécessite numpy<1.24, chatterbox-tts <1.26 → contrainte commune <1.24
numpy>=1.21.0,<1.24.0
accelerate>=1.0.0
datasets>=3.0.0
# sentencepiece: version gérée par ESPnet (0.1.97 pour espnet 202412)
huggingface_hub>=0.20.0
safetensors>=0.4.0
peft>=0.7.0
# Compatible avec chatterbox-tts (requiert 4.46.3)
transformers>=4.46.3
# librosa: version gérée par ESPnet (0.9.2 pour espnet 202412) et chatterbox-tts

# Cache et base de données
redis==5.2.1
asyncpg==0.30.0
aiosqlite==0.20.0
dnspython==2.7.0

# Détection de langue et analyse de texte
langdetect==1.0.9
nltk==3.9.1
textstat==0.7.4

# Utilitaires système
psutil==6.1.1
# numpy version managed by dependencies (chatterbox-tts requires numpy<1.26.0)
# pandas 2.0.x works with numpy<1.26.0 on Python 3.12
pandas>=2.0.0,<2.1.0
aiohttp==3.11.11
python-multipart==0.0.20
aiofiles==24.1.0

# ═══════════════════════════════════════════════════════════════════════════════
# VOICE FEATURES - MANDATORY FOR MEESHY PLATFORM
# ═══════════════════════════════════════════════════════════════════════════════
# Meeshy requires both STT (Speech-to-Text) and TTS (Text-to-Speech) for:
# - Voice message transcription
# - Translated audio generation with voice cloning
# - Real-time voice translation pipeline
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────────
# STT (Speech-to-Text) - MANDATORY
# ─────────────────────────────────────────────────────────────────────────────────
# faster-whisper provides high-quality transcription with language detection
# Supports: Python 3.8+ including Python 3.12 ✓
# Note: 1.1.0+ removed tokenizers dependency (uses ctranslate2's tokenizer)
# and allows av>=11 which has pre-built wheels (av-12.x+)
faster-whisper==1.2.1

# ─────────────────────────────────────────────────────────────────────────────────
# TTS (Text-to-Speech) - MANDATORY - Multi-model support
# Select model via TTS_MODEL environment variable
# Default: chatterbox (recommended for commercial use)
# ─────────────────────────────────────────────────────────────────────────────────

# CHATTERBOX (DEFAULT - MANDATORY) - Apache 2.0 License
# ✓ Best quality/speed balance for production
# ✓ Commercial use allowed
# ✓ Requires Python 3.11 (configured via .python-version)
# Set TTS_MODEL=chatterbox or TTS_MODEL=chatterbox-turbo
# NOTE: Installé séparément avec --no-deps dans Dockerfile (conflit numpy)
# Dépendances manuelles de chatterbox-tts (pour installation --no-deps):
resampy==0.4.3
s3tokenizer
diffusers==0.29.0
resemble-perth==1.0.1
omegaconf==2.3.0
conformer==0.3.2
spacy>=3.4.0
einops
soxr  # Requis par transformers/audio_utils pour chatterbox-tts
# chatterbox-tts==0.1.6 (installé dans Dockerfile avec --no-deps)

# HIGGS AUDIO V2 (OPTIONAL) - State-of-the-art quality
# ✓ Uses transformers (already included above)
# ⚠️ Commercial use limited to <100k users/year
# Set TTS_MODEL=higgs-audio-v2

# VITS (ESPnet2) - Language-specific TTS
# ✓ Apache 2.0 License - Commercial use allowed
# ✓ Python 3.11-3.13 compatible
# ✓ Used for languages not supported by Chatterbox (e.g., Lingala)
# Set TTS_MODEL=vits
# Note: 202412 est la dernière version compatible numpy<2.0 (avant 202509 qui nécessite numpy>=2.2)
espnet==202412
espnet-model-zoo==0.1.7

# ─────────────────────────────────────────────────────────────────────────────────
# LEGACY TTS OPTIONS (NOT INSTALLED BY DEFAULT)
# ─────────────────────────────────────────────────────────────────────────────────

# XTTS v2 (LEGACY - NOT RECOMMENDED)
# ❌ Coqui Public License - NO commercial use allowed
# ❌ REQUIRES Python < 3.12 (incompatible with Python 3.12+)
# ❌ Coqui closed in 2024, model no longer maintained
# ❌ Has dependency conflicts with CPU-only torch from PyTorch index
# To install manually (Python 3.11 only): pip install TTS>=0.22.0
# Set TTS_MODEL=xtts-v2
# TTS==0.22.0  # Commented out - use chatterbox-tts instead (Apache 2.0 license)

# OpenVoice V2 (LEGACY) - Voice Cloning
# ❌ INCOMPATIBLE with Python 3.11+ (requires Python 3.9-3.10)
# Not installed by default - see requirements-optional.txt for details
# Manual installation: pip install git+https://github.com/myshell-ai/OpenVoice.git

# Audio Processing utilities
pydub==0.25.1
# librosa version managed by espnet (0.9.2) - use utils/audio_utils.py for compat
soundfile>=0.12.1
scipy>=1.10.0
ffmpeg-python==0.2.0

# ─────────────────────────────────────────────────────────────────────────────────
# SPEAKER DIARIZATION - Identification des locuteurs
# ─────────────────────────────────────────────────────────────────────────────────
# Priorité 1: pyannote.audio (précision ~95%, nécessite HF_TOKEN)
pyannote.audio>=3.4.0  # ✅ ACTIVÉ - Compatible torch 2.6.0

# Priorité 2: SpeechBrain - Alternative à pyannote (SANS token HuggingFace requis)
speechbrain>=1.0.0  # ✅ ACTIVÉ - Fallback si pyannote indisponible
scikit-learn>=1.3.0  # Requis pour clustering et nettoyage (DiarizationCleaner)
# librosa déjà inclus dans requirements.txt via chatterbox-tts

# Logging et monitoring
loguru==0.7.3
prometheus-client==0.21.1

# Tests
pytest==8.3.4
pytest-asyncio==0.25.2
pytest-cov==6.0.0
# FIX: httpx 0.24.x pour compatibilité avec Prisma 0.15.0
httpx==0.24.1
httpcore==0.17.3
